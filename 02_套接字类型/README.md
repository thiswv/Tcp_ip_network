## 套接字类型与协议设置

### 2.1 套接字协议及其数据传输特性

#### 什么叫协议？  

> 简单来说就是通信时要遵循的规则  
>
> 比如你用微信给B发信息，那么B也需要用微信接受消息，而不是QQ  

#### 详解创建套接字  

首先来看之前在第一章已经出现过的函数  

```c
#include <sys/socket.h>

int socket(int domain, int type, int protocol);

成功时返回文件描述符，失败返回-1
```

1. domian    套接字中使用的协议族信息  
2. type      套接字数据传输类型信息  
3. protocol  计算机间通信中使用的协议信息  

##### 什么叫协议族？ (Protocol Family)  

宽面和细面都是面条的一种  

与之类似，套接字通信中的协议也具有一些分类  

如大家熟知的IPV4和IPV6都是通信的一种方式  

所以，通过socket函数的第一个参数传递套接字中使用的协议分类信息
，**此协议分类信息陈称为议族**  

| 名称  | 协议族  |
|---|---|
| PF_INET  | IPv4互联网协议族  |
| PF_INET6  | IPv6互联网协议族  |
| PF_LOCAL  | 本地通信的UNIX协议族  |
| PF_PACKET  | 底层套接字的协议族  |
| PF_IPX  | IPX NOvell协议族  |

不过本书的重点在**PF_INET**上，也就是重点讲IPv4  

其次，套接字中实际采用的最终协议信息是通过socket函数的第三个参数传递的

记住**在指定的协议族范围内通过第一个参数决定第三个参数**

#### 套接字类型（type）

为什么要将套接字类型嗯，因为，同一种协议族类可能会有多种数据传输方式  

就是说决定了协议族，**并不能决定数据的传输方式**  

#### 介绍两种PF_INET的数据传输方式  

##### 面向连接的套接字(SOCK_STREAM)

如果socket函数第一个参数为PF_INET，第二个参数选择SOCK_STREAM，**则建立了面向连接的套接字**  

1. 传输过程中数据不会消失
2. 按序传输数据
3. 传输的数据没有数据边界

![2.1](2.1.png )

图中通过独立的传送带传输数据，只要传送带本身没有问题，那么数据就不会丢失。  

同时，较晚传输的数据不会先到达，因为传送带保证了数据的按序传递。  

其次我们可以观察到，假设有100颗糖果从前面的工人处传输给后一个工人。后面的工人是等收集完全部的100个糖果后才封装袋子。

因此，**面向连接的套接字不存在数据边界**  

#### 思考

> 竟然面向连接的套接字是有序的，那为什么**tcp在接受数据时还是为出现接受的到达时间好快慢呢**？
>
> 因为它虽然有序，但是传输的快慢有差异
